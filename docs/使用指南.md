# ORIN 系统增强 - 使用指南

本文档提供 ORIN 系统新增功能的快速使用指南。

---

## 🚀 快速开始

### 1. 启动系统

```bash
# 进入项目目录
cd /Users/adlin/Desktop/JAVA

# 启动系统
./manage.sh start

# 或分别启动
cd orin-backend && mvn spring-boot:run
cd orin-frontend && npm run dev
```

### 2. 访问系统

- 前端地址: http://localhost:5173
- 后端 API: http://localhost:8080
- Swagger 文档: http://localhost:8080/swagger-ui.html

---

## 📋 功能使用指南

### 1. 日志级别动态调整

**访问路径**: 系统设置 → 日志配置 → 日志级别管理

**功能说明**:
- 运行时调整日志级别，无需重启
- 支持单个/批量/临时调整
- 自动恢复功能

**使用步骤**:
1. 进入日志配置页面
2. 切换到"日志级别管理" Tab
3. 在 Logger 列表中选择要调整的 Logger
4. 选择新的日志级别（TRACE/DEBUG/INFO/WARN/ERROR/OFF）
5. 点击确认，立即生效

**API 示例**:
```bash
# 设置日志级别
curl -X PUT http://localhost:8080/api/v1/system/log-config/loggers/com.adlin.orin \
  -H "Content-Type: application/json" \
  -d '{"level": "DEBUG"}'
```

---

### 2. 智能体版本管理

**使用组件**: `AgentVersionManager.vue`

**功能说明**:
- 自动保存配置版本
- 一键回滚到历史版本
- 版本对比功能

**使用步骤**:

#### 创建版本
1. 在智能体详情页面找到"版本管理"区域
2. 点击"创建新版本"
3. 填写变更说明
4. 点击创建，系统自动保存当前配置快照

#### 回滚版本
1. 在版本历史中找到目标版本
2. 点击"回滚"按钮
3. 确认回滚操作
4. 系统自动恢复该版本的配置

#### 版本对比
1. 点击"对比"按钮
2. 选择两个版本号
3. 查看配置差异

**API 示例**:
```bash
# 创建版本
curl -X POST http://localhost:8080/api/v1/agents/agent001/versions \
  -H "Content-Type: application/json" \
  -d '{"description": "优化模型参数", "createdBy": "admin"}'

# 回滚版本
curl -X POST http://localhost:8080/api/v1/agents/agent001/versions/{versionId}/rollback
```

---

### 3. 知识库文档管理

**使用组件**: `DocumentManager.vue`

**功能说明**:
- 文档上传和存储
- 向量化状态管理
- 文档预览和统计

**使用步骤**:

#### 上传文档
1. 进入知识库详情页面
2. 点击"上传文档"
3. 拖拽或选择文件（支持 PDF, TXT, MD, DOCX）
4. 点击上传

#### 触发向量化
1. 在文档列表中找到待处理文档
2. 点击"向量化"按钮
3. 系统自动处理文档并更新状态

#### 查看文档
1. 点击文档行或"预览"按钮
2. 查看文档详情和内容预览
3. 查看向量化状态和分块信息

**API 示例**:
```bash
# 上传文档
curl -X POST http://localhost:8080/api/v1/knowledge/kb001/documents/upload \
  -F "file=@document.pdf" \
  -F "uploadedBy=admin"

# 触发向量化
curl -X POST http://localhost:8080/api/v1/knowledge/documents/{docId}/vectorize
```

---

### 4. 多模态文件管理

**使用组件**: `MultimodalUpload.vue`

**功能说明**:
- 支持图片、音频、视频、文档
- 自动生成缩略图
- 文件预览和下载

**使用步骤**:

#### 上传文件
1. 进入多模态文件管理页面
2. 点击"上传文件"
3. 选择文件（支持多种格式）
4. 点击上传

#### 查看文件
1. 在文件网格中点击文件卡片
2. 查看文件详情
3. 图片可直接预览
4. 音频/视频可在线播放

#### 下载文件
1. 点击文件卡片上的下载按钮
2. 或在详情页面下载

**API 示例**:
```bash
# 上传文件
curl -X POST http://localhost:8080/api/v1/multimodal/upload \
  -F "file=@image.jpg" \
  -F "uploadedBy=admin"

# 获取缩略图
curl http://localhost:8080/api/v1/multimodal/files/{fileId}/thumbnail \
  --output thumbnail.jpg
```

---

## 🔧 配置说明

### 文件存储目录

系统需要以下目录用于文件存储：

```bash
# 创建目录
sudo mkdir -p /var/orin/uploads/{documents,multimodal}
sudo chown -R $(whoami) /var/orin/uploads
```

### 数据库表

首次启动时会自动创建以下表：
- `agent_versions` - 智能体版本
- `kb_documents` - 知识库文档
- `multimodal_files` - 多模态文件

---

## 📊 组件集成

### 在页面中使用组件

```vue
<template>
  <div>
    <!-- 版本管理 -->
    <AgentVersionManager :agent-id="agentId" />
    
    <!-- 文档管理 -->
    <DocumentManager :knowledge-base-id="kbId" />
    
    <!-- 多模态文件 -->
    <MultimodalUpload />
  </div>
</template>

<script setup>
import AgentVersionManager from '@/components/AgentVersionManager.vue'
import DocumentManager from '@/components/DocumentManager.vue'
import MultimodalUpload from '@/components/MultimodalUpload.vue'
</script>
```

---

## ⚠️ 注意事项

1. **文件大小限制**: 默认单个文件不超过 50MB
2. **存储空间**: 确保有足够的磁盘空间
3. **权限**: 确保文件存储目录有写权限
4. **性能**: 大量文件上传时建议分批处理

---

## 🐛 常见问题

### Q: 文件上传失败？
A: 检查：
- 文件大小是否超限
- 存储目录权限是否正确
- 磁盘空间是否充足

### Q: 向量化一直处于 PENDING 状态？
A: 需要配置向量化服务（如 Dify API），或手动触发向量化

### Q: 版本回滚后配置没有变化？
A: 检查版本快照中是否包含所需字段，某些字段可能不在版本控制范围内

---

**文档版本**: v1.0  
**更新日期**: 2026-01-13
