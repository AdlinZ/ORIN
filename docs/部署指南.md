# ORIN ç³»ç»Ÿéƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£æä¾› ORIN ç³»ç»Ÿçš„å®Œæ•´éƒ¨ç½²è¯´æ˜ã€‚

---

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

### åŸºç¡€ç¯å¢ƒ

- **Java**: JDK 17+
- **Node.js**: 16+
- **MySQL**: 8.0+
- **Redis**: 6.0+ (å¯é€‰ï¼Œç”¨äºé™æµ)
- **Maven**: 3.8+
- **npm**: 8+

### å¯é€‰ç»„ä»¶

- **FFmpeg**: ç”¨äºéŸ³è§†é¢‘å¤„ç†
- **å¯¹è±¡å­˜å‚¨**: é˜¿é‡Œäº‘ OSS / AWS S3ï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. å…‹éš†ä»£ç 

```bash
cd /path/to/workspace
# å‡è®¾ä»£ç å·²åœ¨ /Users/adlin/Desktop/JAVA
```

### 2. é…ç½®æ•°æ®åº“

```bash
# ç™»å½• MySQL
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE orindb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# åˆ›å»ºç”¨æˆ·ï¼ˆå¯é€‰ï¼‰
CREATE USER 'orin'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON orindb.* TO 'orin'@'localhost';
FLUSH PRIVILEGES;
```

### 3. é…ç½®åç«¯

ç¼–è¾‘ `orin-backend/src/main/resources/application.properties`:

```properties
# æ•°æ®åº“é…ç½®
spring.datasource.url=jdbc:mysql://localhost:3306/orindb?createDatabaseIfNotExist=true&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=your_password

# JWT å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼‰
jwt.secret=${JWT_SECRET:your-secret-key-at-least-256-bits-long}

# æ–‡ä»¶å­˜å‚¨è·¯å¾„
file.storage.local.path=/var/orin/uploads

# é‚®ä»¶é…ç½®ï¼ˆå¯é€‰ï¼‰
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=${MAIL_USERNAME:}
spring.mail.password=${MAIL_PASSWORD:}

# å‘Šè­¦é…ç½®ï¼ˆå¯é€‰ï¼‰
alert.dingtalk.webhook=${DINGTALK_WEBHOOK:}
alert.wechat.webhook=${WECHAT_WEBHOOK:}

# Resilience4j å®¹é”™é…ç½®
resilience4j.circuitbreaker.instances.siliconFlow.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.siliconFlow.wait-duration-in-open-state=10s
resilience4j.retry.instances.siliconFlow.max-attempts=3
```

### 4. åˆ›å»ºæ–‡ä»¶å­˜å‚¨ç›®å½•

```bash
sudo mkdir -p /var/orin/uploads/{documents,multimodal}
sudo chown -R $(whoami) /var/orin/uploads
```

### 5. ç¼–è¯‘åç«¯

```bash
cd orin-backend
mvn clean package -DskipTests
```

### 6. å®‰è£…å‰ç«¯ä¾èµ–

```bash
cd orin-frontend
npm install
```

### 7. å¯åŠ¨ç³»ç»Ÿ

```bash
# å›åˆ°é¡¹ç›®æ ¹ç›®å½•
cd /Users/adlin/Desktop/JAVA

# ä½¿ç”¨ç®¡ç†è„šæœ¬å¯åŠ¨
./manage.sh start

# æˆ–æ‰‹åŠ¨å¯åŠ¨
# åç«¯
cd orin-backend && mvn spring-boot:run &

# å‰ç«¯
cd orin-frontend && npm run dev &
```

### 8. éªŒè¯éƒ¨ç½²

- å‰ç«¯: http://localhost:5173
- åç«¯: http://localhost:8080
- Swagger: http://localhost:8080/swagger-ui.html
- Actuator: http://localhost:8080/actuator/health

---

## ğŸ”§ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. æ„å»ºç”Ÿäº§åŒ…

```bash
# åç«¯
cd orin-backend
mvn clean package -DskipTests
#java -jar target/orin-backend-1.0.0-SNAPSHOT.jar
```

> [!TIP]
> éƒ¨ç½²æ—¶è¯·æŸ¥çœ‹ [ç¯å¢ƒé…ç½®æŒ‡å—](../ENVIRONMENT_SETUP.md) ä»¥è·å–å®Œæ•´çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ï¼Œç‰¹åˆ«æ˜¯ `MILVUS_HOST` å’Œ `REDIS_HOST`ã€‚
# å‰ç«¯
cd orin-frontend
npm run build
# ç”Ÿæˆ dist/ ç›®å½•
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶:

```bash
# JWT
export JWT_SECRET="your-production-secret-key-must-be-very-long-and-secure"

# æ•°æ®åº“
export DB_HOST="your-db-host"
export DB_PORT="3306"
export DB_NAME="orindb"
export DB_USER="orin"
export DB_PASSWORD="your-db-password"

# é‚®ä»¶
export MAIL_USERNAME="your-email@gmail.com"
export MAIL_PASSWORD="your-app-password"

# å‘Šè­¦
export DINGTALK_WEBHOOK="https://oapi.dingtalk.com/robot/send?access_token=xxx"
export DINGTALK_SECRET="your-secret"
export WECHAT_WEBHOOK="https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxx"

# å¯¹è±¡å­˜å‚¨ï¼ˆå¯é€‰ï¼‰
export OSS_ACCESS_KEY_ID="your-access-key"
export OSS_ACCESS_KEY_SECRET="your-secret-key"
export OSS_BUCKET_NAME="orin-files"

# å®‰å…¨é…ç½®
export CORS_ALLOWED_ORIGINS="http://localhost:5173,https://orin.asia"
```

### 3. ä½¿ç”¨ Systemd ç®¡ç†æœåŠ¡

åˆ›å»º `/etc/systemd/system/orin-backend.service`:

```ini
[Unit]
Description=ORIN Backend Service
After=network.target mysql.service

[Service]
Type=simple
User=orin
WorkingDirectory=/opt/orin/backend
EnvironmentFile=/opt/orin/.env
ExecStart=/usr/bin/java -jar -Xms1g -Xmx2g orin-backend.jar
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡:

```bash
sudo systemctl daemon-reload
sudo systemctl enable orin-backend
sudo systemctl start orin-backend
sudo systemctl status orin-backend
```

### 4. ä½¿ç”¨ Nginx éƒ¨ç½²å‰ç«¯

Nginx é…ç½® `/etc/nginx/sites-available/orin`:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯
    location / {
        root /opt/orin/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    # åç«¯ API
    location /api/ {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Actuator (ä»…å†…ç½‘è®¿é—®)
    location /actuator/ {
        allow 10.0.0.0/8;
        deny all;
        proxy_pass http://localhost:8080;
    }
}
```

å¯ç”¨é…ç½®:

```bash
sudo ln -s /etc/nginx/sites-available/orin /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

---

## ğŸ“Š æ•°æ®åº“è¿ç§»

é¦–æ¬¡å¯åŠ¨æ—¶ï¼ŒJPA ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹è¡¨ï¼š

- `agent_metadata` - æ™ºèƒ½ä½“å…ƒæ•°æ®
- `agent_versions` - æ™ºèƒ½ä½“ç‰ˆæœ¬
- `agent_access_profile` - æ™ºèƒ½ä½“è®¿é—®é…ç½®
- `knowledge_base` - çŸ¥è¯†åº“
- `kb_documents` - çŸ¥è¯†åº“æ–‡æ¡£
- `multimodal_files` - å¤šæ¨¡æ€æ–‡ä»¶
- `alert_rules` - å‘Šè­¦è§„åˆ™
- `alert_history` - å‘Šè­¦å†å²
- `audit_log` - å®¡è®¡æ—¥å¿—
- `log_config` - æ—¥å¿—é…ç½®

**æ³¨æ„**: ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ Flyway æˆ– Liquibase è¿›è¡Œç‰ˆæœ¬åŒ–è¿ç§»ã€‚

---

## ğŸ”’ å®‰å…¨é…ç½®

### 1. ä¿®æ”¹é»˜è®¤å¯†é’¥

```bash
# ç”Ÿæˆå¼ºå¯†é’¥
openssl rand -base64 64

# è®¾ç½®ç¯å¢ƒå˜é‡
export JWT_SECRET="ç”Ÿæˆçš„å¯†é’¥"
```

### 2. é…ç½® HTTPS

ä½¿ç”¨ Let's Encrypt:

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

### 3. é…ç½®é˜²ç«å¢™

```bash
# ä»…å¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. JVM å‚æ•°

```bash
java -jar \
  -Xms2g -Xmx4g \
  -XX:+UseG1GC \
  -XX:MaxGCPauseMillis=200 \
  -XX:+HeapDumpOnOutOfMemoryError \
  -XX:HeapDumpPath=/var/log/orin/heap-dump.hprof \
  orin-backend.jar
```

### 2. æ•°æ®åº“ä¼˜åŒ–

```sql
-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_agent_id ON kb_documents(knowledge_base_id);
CREATE INDEX idx_upload_time ON kb_documents(upload_time);
CREATE INDEX idx_triggered_at ON alert_history(triggered_at);

-- å®šæœŸæ¸…ç†æ—§æ•°æ®
DELETE FROM audit_log WHERE created_at < DATE_SUB(NOW(), INTERVAL 90 DAY);
```

### 3. Redis ç¼“å­˜

å¯ç”¨ Redis ç”¨äºé™æµå’Œç¼“å­˜:

```properties
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.cache.type=redis
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### æŸ¥çœ‹æ—¥å¿—

```bash
# åç«¯æ—¥å¿—
tail -f /var/log/orin/backend.log

# ç³»ç»Ÿæ—¥å¿—
sudo journalctl -u orin-backend -f
```

### å¸¸è§é—®é¢˜

**Q: æ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥ MySQL çŠ¶æ€
sudo systemctl status mysql

# æµ‹è¯•è¿æ¥
mysql -h localhost -u orin -p orindb
```

**Q: æ–‡ä»¶ä¸Šä¼ å¤±è´¥**
```bash
# æ£€æŸ¥ç›®å½•æƒé™
ls -la /var/orin/uploads
sudo chown -R orin:orin /var/orin/uploads
```

**Q: å†…å­˜ä¸è¶³**
```bash
# å¢åŠ  JVM å †å†…å­˜
# ä¿®æ”¹ systemd é…ç½®ä¸­çš„ -Xmx å‚æ•°
```

---

## ğŸ“¦ å¤‡ä»½ä¸æ¢å¤

### æ•°æ®åº“å¤‡ä»½

```bash
# å¤‡ä»½
mysqldump -u root -p orindb > orin_backup_$(date +%Y%m%d).sql

# æ¢å¤
mysql -u root -p orindb < orin_backup_20260113.sql
```

### æ–‡ä»¶å¤‡ä»½

```bash
# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
tar -czf orin_files_$(date +%Y%m%d).tar.gz /var/orin/uploads

# æ¢å¤
tar -xzf orin_files_20260113.tar.gz -C /
```

---

## ğŸ”„ æ›´æ–°å‡çº§

```bash
# 1. å¤‡ä»½æ•°æ®
./backup.sh

# 2. åœæ­¢æœåŠ¡
./manage.sh stop

# 3. æ›´æ–°ä»£ç 
git pull origin main

# 4. é‡æ–°ç¼–è¯‘
cd orin-backend && mvn clean package -DskipTests
cd orin-frontend && npm run build

# 5. å¯åŠ¨æœåŠ¡
./manage.sh start

# 6. éªŒè¯
./manage.sh status
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2026-01-13
